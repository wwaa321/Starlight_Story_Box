### 星辉故事盒子 - 有声书小工具介绍文档

#### 1. 概述
**星辉故事盒子** 是一款专为视障儿童设计的有声书制作工具。它能够将绘本等图像内容转换为有声故事，帮助视障儿童通过听觉感受绘本的精彩内容。用户可以通过简单的操作，上传图片、生成故事文本，并选择音色生成有声故事音频。

![](https://github.com/wwaa321/Starlight_Story_Box/blob/main/img/view.jpg)
---

#### 2. 主要功能
1. **制作有声书**
   - 用户点击“制作有声书”按钮，进入故事创建页面。
   - 输入故事名称和描述，支持多行输入。
   - 点击“下一步”进入图片上传页面。

2. **上传图片**
   - 在图片上传页面，用户可以选择并上传一张图片。
   - 上传成功后，图片会显示在左侧预览区域。
   - 点击“分析图片”按钮，系统会自动分析图片内容并生成故事文本，显示在右侧文本框中。

3. **保存分析结果**
   - 如果对生成的内容满意，用户可以点击“保存结果”按钮，将当前分析结果保存为故事的一页。
   - 如果需要清空所有已保存的结果，可以点击“清空结果”按钮。

4. **继续创作**
   - 点击“继续创作”按钮，保存当前所有分析结果并进入生成故事页面。

5. **生成故事**
   - 在生成故事页面，系统会显示故事名称、描述和章节数量。
   - 点击“生成故事”按钮，系统会根据已保存的章节内容生成完整的故事文本，显示在左侧预览区域。
   - 在右侧选择音色（如“龙书”、“龙妙”、“龙悦”），然后点击“创作故事音频”按钮，系统会生成有声故事音频。

6. **配置**
   - 如果需要配置 API 相关参数，可以点击“配置”按钮，在弹出的对话框中填写 API Key、API Secret、API Token、API Endpoint 和 API Model 等信息。

---

#### 3. 使用说明
1. **制作有声书**
   - 点击“制作有声书”按钮，进入故事创建页面。
   - 在“输入故事名称”框中填写故事名称。
   - 在“输入故事描述”框中填写故事描述，支持多行输入。
   - 点击“下一步”按钮，进入图片上传页面。

2. **上传图片**
   - 在图片上传页面，点击“选择图片”按钮，上传一张图片。
   - 上传成功后，图片会显示在左侧预览区域。
   - 点击“分析图片”按钮，系统会自动分析图片内容并生成故事文本，显示在右侧文本框中。

3. **保存分析结果**
   - 如果对生成的内容满意，可以点击“保存结果”按钮，将当前分析结果保存为故事的一页。
   - 如果需要清空所有已保存的结果，可以点击“清空结果”按钮。

4. **继续创作**
   - 点击“继续创作”按钮，保存当前所有分析结果并进入生成故事页面。

5. **生成故事**
   - 在生成故事页面，系统会显示故事名称、描述和章节数量。
   - 点击“生成故事”按钮，系统会根据已保存的章节内容生成完整的故事文本，显示在左侧预览区域。
   - 在右侧选择音色（如“龙书”、“龙妙”、“龙悦”），然后点击“创作故事音频”按钮，系统会生成有声故事音频。

6. **配置**
   - 初次使用需要配置 API 相关参数，可以点击“配置”按钮，在弹出的对话框中填写相关信息。

---

#### 4. 注意事项
- 确保上传的图片清晰，以便系统能够准确分析图片内容。
- 生成音频时，请耐心等待，系统会显示进度环和提示信息。
- 如果遇到问题，可以查看页面底部的提示信息或重新操作。

---

#### 5. 技术实现
- **图像分析**：通过 `dashscope` 的视觉模型（如 `qwen-vl-max-latest`）分析图片内容，生成故事文本。
- **故事生成**：通过 `dashscope` 的聊天模型（如 `qwen-max`）根据用户输入生成故事内容。
- **音频生成**：通过 `dashscope` 的文本转语音功能，将故事文本转换为有声故事音频。
- **用户界面**：使用 `flet` 框架构建跨平台的桌面应用界面。

---

#### 6. 依赖库
- `flet`：用于构建用户界面。
- `dashscope`：用于图像分析、故事生成和音频生成。
- `openai`：用于调用大模型 API。
- `xml.etree.ElementTree`：用于解析 XML 配置文件。
- [json](data/story_data.json)：用于处理 JSON 数据。
- `pathlib`：用于路径操作。
- `datetime`：用于生成时间戳。

---

#### 7. 配置文件
- **`configuration/configuration.xml`**：存储 API 相关配置，包括 API Key、Base URL、Chat Model 和 Vision Model 等信息。




---

**星辉故事盒子**，让每一个孩子都能听到精彩的故事！
